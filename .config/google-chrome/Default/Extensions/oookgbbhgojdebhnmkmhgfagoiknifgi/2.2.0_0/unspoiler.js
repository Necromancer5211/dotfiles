/*! Unspoiler - v2.2.0 - 2014-01-23 */function unspoilerLoad(){}function getFlagStatus(){isCheckingFlagStatus||0!==jQuery("#unsp-flag").length||(isCheckingFlagStatus=!0,chrome.extension.sendMessage({method:"getFlagStatus"}))}function setFlagOff(){chrome.extension.sendMessage({method:"setFlagOff"})}function addFlag(){0===jQuery("#unsp-flag").length&&(jQuery("body").append('<div id="unsp-flag" style="z-index: 1000; position: absolute; top: 0; left: 0; width: 100%; min-height: 30px; font-size: 14px; color: #FFF; background: #990000; font-family: Arial, sans-serif; box-sizing: border-box; padding: 5px 10px 5px 50px;"><span class="unsp-close" style="float: right; cursor: pointer;">x</span><span class="unsp-disable" style="float: right; cursor: pointer; margin-right: 15px; text-decoration: underline;">Don\'t show this again</span><span style="border-radius: 3px; display: inline-block; padding: 2px 4px; font-size: 11.844px; font-weight: bold; line-height: 14px; color: #990000; white-space: nowrap; vertical-align: baseline; background-color: #FFF; margin-right: 5px;" class="unsp-brand">Unspoiler</span>This page contains spoilers. Continue at your own risk.</div>'),jQuery(".unsp-close").on("click",function(){var a=jQuery(this).parent();a.hide()}),jQuery(".unsp-disable").on("click",function(){var a=jQuery(this).parent();a.hide(),setFlagOff()}))}function isSpoiled(a){var b=a.parents(),c=!0;return b.each(function(){jQuery(this).hasClass("unsp-content")&&(c=!1)}),c}function unsanitize(){jQuery("[data-unsp-sanitized=clean]").attr("data-unsp-sanitized","dirty")}function Freshener(){var a={};switch(a.getSelectors=function(){return"h1[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],h2[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],h3[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],h4[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],h5[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],h6[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],a[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled]"},a.hasHref=function(a){return a.find("[href]:first").length>0||void 0!==a.prop("href")},a.getSpoilerData=function(a,b){var c=$(a).next().find("[href]:first");return 0===c.length&&(c=a),{title:$(c).text(),tag:b,url:$(c).prop("href")}},window.location.hostname){case"www.facebook.com":return new FacebookFreshener(a);case"twitter.com":return new TwitterFreshener(a);case"www.unspoiler.tv":return new UnspoilerFreshener(a);default:return a}}function FacebookFreshener(a){return a.getSelectors=function(){return".userContentWrapper[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],.UFICommentContent[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],.uiStreamMessage[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled],.uiStreamAttachments[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled]"},a.hasHref=function(a){return a.find(".uiAttachmentTitle a, a.shareText[href], .userContent a[href][rel]").length>0},a.getSpoilerData=function(a,b){var c=$(a).next().find(".uiAttachmentTitle a, a.shareText[href], .userContent a[href][rel]");return{title:$(c).text(),tag:b,url:$(c).prop("href")}},a}function UnspoilerFreshener(a){return a.getSelectors=function(){return""},a}function TwitterFreshener(a){return a.getSpoilerData=function(a,b){var c=$(a).parent().prev();return{title:c.find(".account-group .fullname").text()+" spoiler about "+b,tag:b,url:c.find(".js-permalink").prop("href")}},a.hasHref=function(){return!0},a.getSelectors=function(){return".tweet-text[data-unsp-sanitized!=clean][data-unsp-sanitized!=unspoiled]"},a}function unspoil(a){var b=new Freshener,c=jQuery(b.getSelectors()),d=[],e=[];for(var f in a){var g=a[f].split(" "),h="";for(var i in g)h=h+g[i]+"\\s";e[f]=new RegExp(h.substring(0,h.length-2),"gi")}c.each(function(){var b=jQuery(this),c=!1,f=[];for(var g in e)b.text().match(e[g])&&(c=!0,f.push(a[g]));c&&(d.push({elm:b,tags:f}),b.attr("data-unsp-sanitized","unspoiled")),c||b.attr("data-unsp-sanitized","clean")});for(var j in d){var k=d[j].elm,l=d[j].tags,m='<div class="unsp-warning" style="background: #990000; color: #FFF; font-size: 14px; line-height: 2; font-family: Arial, sans-serif; padding: 5px 75px 5px 5px; margin-bottom: 20px;"><span style="border-radius: 3px; display: inline-block; padding: 2px 4px; font-size: 11.844px; font-weight: bold; line-height: 14px; color: #990000; white-space: nowrap; vertical-align: baseline; background-color: #FFF; margin-right: 5px;" class="unsp-brand">Unspoiler</span> Warning! This may be a spoiler for '+l+".</div>",n='<div class="unsp-reveal" style="font-size: 10px; position: absolute; top: 5px; right: 10px; color: #FFF; font-family: Arial, sans-serif; cursor: pointer; height: 10px; line-height: 1;">Show spoiler</div>',o='<div class="unsp-save" style="font-size: 10px; position: absolute; bottom: 5px; right: 10px; color: #FFFF00; font-family: Arial, sans-serif; cursor: pointer; height: 10px; line-height: 1;">Save spoiler</div>',p='<div class="unsp-content"></div>';if(isSpoiled(k)){k.parent().css("position","relative"),k.hasClass("uiStreamMessage")&&(k=k.parent());var q=b.hasHref(k);q||(o=""),k.after('<div class="unsp-container" style="position: relative;">'+m+n+o+p+"</div>");var r=k.next();r.find(".unsp-content").html(k).hide(),q||r.find(".unsp-reveal").on("click",showUnspoiler),q&&(r.find(".unsp-reveal").on("click",showUnspoilerHref),r.find(".unsp-save").one("click",function(a){a.stopPropagation(),jQuery(this).text("Spoiler saved at unspoiler.tv");var c=b.getSpoilerData(this,l);saveSpoiler(c),jQuery(this).on("click",redirectToUnspoiler)})),getFlagStatus()}}c=[],d=[],a=[]}$(unspoilerLoad);var executeFilters=function(){chrome.extension.sendMessage({method:"filterTab"})},saveSpoiler=function(a){chrome.extension.sendMessage({method:"saveSpoiler",data:a})};document.addEventListener("ajaxUpdated",executeFilters);var syncCompleteEvent=document.createEvent("Event");syncCompleteEvent.initEvent("syncComplete",!0,!0);var isCheckingFlagStatus=!1,currentTags=[],isFilterReady=!0,requestCounter=0,requestThrottleLimit=3,unspoilerInterval=1e3,messageListener=function(a){return a.method&&("getFlagStatus"===a.method&&a.showFlag&&addFlag(),"syncComplete"===a.method&&document.dispatchEvent(syncCompleteEvent)),a.search?void doFilter(a.search):void 0},doFilter=function(a){currentTags!==a.join(",")&&(currentTags=a.join(","),unsanitize()),unspoil(a)};chrome.extension.onMessage.addListener(messageListener);var showUnspoiler=function(a){a.stopPropagation(),jQuery(this).prev().hide().end().hide().next().show()},showUnspoilerHref=function(a){a.stopPropagation(),jQuery(this).prev().hide().end().hide().next().hide().next().show()},redirectToUnspoiler=function(a){a.stopPropagation(),window.location.href="http://www.unspoiler.tv/spoilers"},injectScript=function(a){var b=document.createElement("script");b.type="text/javascript",b.innerHTML=a,document.documentElement.appendChild(b)};injectScript("("+function(){var a=!0;window.onfocus=window.onblur=function(b){a="focus"===(b||event).type};var b=document.createEvent("Event");b.initEvent("ajaxUpdated",!0,!0);var c=function(){a&&4===this.readyState&&200===this.status&&document.dispatchEvent(b)},d=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){arguments.callee.caller;return this.addEventListener("readystatechange",c,!0),d.apply(this,[].slice.call(arguments))}}.toString()+")()");