function findUserSnippetIds(a){var b={};$.get(codotaHost+"/api/user-snippets/ids").done(function(c){_.forEach(c,function(a){b[a.snippet_hash]=a.id}),a(b)}).fail(function(){console.log("could not read user codebox"),a({})})}function replaceSnippets(a,b){b=mergeWithDefaultCallbacks(b),a=filterCodeBlocks(a,b.extractLines),0==a.length||a.length>50||findUserSnippetIds(function(c){0==numberOfReplacements&&(_gaq.push(["_trackPageview"]),$("body").append('<div class="codota-scope"><div class="green-popovers-container"></div></div>'),interceptCodeSelection(b));var d=0,e=0,f=0,g=a.length;_gaq.push(["_setCustomVar",1,"Number of snippets",g]),numberOfReplacements++,$(a).each(function(a,h){var i=b.extractLines(h);i=i.replace(/\u00A0/g," ").replace(/\r/g,"");var j=b.shouldEnhance(i,h),k=calcSnippetHash(i),l=calcSnippetHashLegacy(i),m=c[k],n=void 0!==m;!n&&c[l]&&(k=l,m=c[k],n=void 0!==m);var o=function(a){var c={"data-original-code":i,"data-user-snippet-id":m,"data-snippet-id":k,"data-snippet-saved":n};if(d++,f++,j&&a.enhanced){a.formattedHtml=prettifyCode(a.formattedHtml,b.shouldAddLineNumbers(h)),b.replaceCode(h,a);var l=$(h).nextAll("pre:first");l.attr(c),$(h).remove(),formatLivecode(l,b),e++,_gaq.push(["_trackEvent","snippet","snippet_enhanced"])}else $(h).before($('<div class="top-box hide"><div class="alert-info"></div></div>')),$(h).attr(c),$(h).is(".prettyprint")&&!$(h).is(".prettyprinted")&&$(h).addClass("prettyprinted"),_gaq.push(["_trackEvent","snippet","snippet_not_enhanced"]);d>=g&&finalizePage(e,f,b)},p=function(){$.ajax({type:"POST",dataType:"json",url:browserBackendHost+"/api/livecode?ver="+manifest.version,data:{code:i,shouldEnhance:!0},beforeSend:function(a){a.setRequestHeader("X-Save-CDN","Yes")},timeout:15e3,success:o,error:function(a,c,h){d++,_gaq.push(["_trackEvent","snippet","snippet_error",a.responseText]),d>=g&&finalizePage(e,f,b)}})};j?p():o({})})})}function interceptCopyCommand(){$(document).keydown(function(a){a.keyCode==ctrlKey&&(ctrlDown=!0),a.metaKey&&(cmdDown=!0)}).keyup(function(a){a.keyCode==ctrlKey&&(ctrlDown=!1),a.metaKey&&(cmdDown=!1)}),$(document).keydown(function(a){if((ctrlDown||cmdDown)&&(a.keyCode==vKey||a.keyCode==cKey)){var b=$(window.getSelection().baseNode).parents("pre[data-snippet-id]");b.length>0&&(showSaveReminder(b),MixpanelManager.track("Extension - Save Reminder",{Initiator:"Clipboard Action"}))}})}function interceptCodeSelection(a){$("body").mouseup(function(b){if(0==$(b.target).parents(".top-bar-placeholder").length){var c=$(window.getSelection().baseNode).parents("pre[data-snippet-id]");const d=window.getSelection();hideSaveSelectionButtons(c,a),"Range"==d.type&&c.length>0&&d.toString().length&&setOnSnippetSelected(c,d.toString(),a)}})}function filterCodeBlocks(a,b){var c=[];return a.each(function(a,d){var e=b($(d));e.length>50&&e.length<1e4&&c.push(d)}),c}function mergeWithDefaultCallbacks(a){var b={extractLines:genericLinesExtractor,replaceCode:function(a,b){$(a).after(b.formattedHtml)},loading:function(a,b){return""},topBarPositioningElement:function(a){return a},shouldEnhance:function(a){return!1},getSnippetTags:function(a){return[]},shouldAddLineNumbers:function(a){return!1},done:function(){return null}};for(var c in a)b[c]=a[c];return b}function genericLinesExtractor(a){var b=$(a).clone(),c="";if(b.is(".syntaxhighlighter")){var d=b.find("td.code");d.length>0?(d.find(".line").append("\n"),d.find("br").replaceWith("\n")):d=b.find(".content").append("\n"),c=d.text()}else b.find(".line").append("\n"),b.find("li").append("\n"),b.find("pre").append("\n"),b.find(".CodeMirror-linenumber").replaceWith(" "),b.find("br").replaceWith("\n"),c=b.text();return c}function setABGroup(a){_gaq.push(["_setCustomVar",3,"a-b_group",a,1]),ab_group=a}function finalizePage(a,b,c){addCodotaTopBar(c),b>0?(_gaq.push(["_trackEvent","page","page_enhanced"]),_gaq.push(["_setCustomVar",2,"Snippets replaced",a]),scrollToSnippet(),c.done()):_gaq.push(["_trackEvent","page","page_not_enhanced"])}function scrollToSnippet(){if(!snippetFound){var a=window.location.href;if(a.indexOf("#")>0){var b=a.substring(a.indexOf("#")+1),c=$("[data-snippet-id='"+b+"']").filter(":not(.top-bar-placeholder)");c.length>0&&(snippetFound=!0,$("html,body").animate({scrollTop:c.offset().top-50}).promise().done(function(){c.fadeTo("slow",.1).fadeTo("slow",1)}))}}}function prettifyCode(a,b){if(b){a=a.replace('class="prettyprint"','class="prettyprint linenums"');var c=$(a);return c[1].innerHTML=prettyPrintOne(c[1].innerHTML,null,!0),c[0].outerHTML+c[1].outerHTML}return prettyPrintOne(a)}function calcSnippetHashLegacy(a){return"ext."+CryptoJS.MD5(a).toString(CryptoJS.enc.Hex)}function calcSnippetHash(a){return"ext."+CryptoJS.MD5(encodeURIComponent(a)).toString(CryptoJS.enc.Hex)}var manifest=chrome.runtime.getManifest(),browserBackendHost="https://app.codota.com",codotaHost="https://www.codota.com",cdnPath="https://d13bwnxpxdeqkp.cloudfront.net/enhanced_prod.1";const CODOTA_APP="https://app.codota.com";var showLineNums=!1,_gaq=_gaq||[];_gaq.push(["_setAccount","UA-41961881-3"]);var ab_group="",numberOfReplacements=0,snippetFound=!1,ctrlDown=!1,cmdDown=!1,ctrlKey=17,vKey=86,cKey=67;