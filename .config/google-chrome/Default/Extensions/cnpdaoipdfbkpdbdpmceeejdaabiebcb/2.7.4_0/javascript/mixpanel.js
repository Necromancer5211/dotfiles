var ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,navigator=window.navigator,userAgent=navigator.userAgent,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,MixpanelManager={config:{apiHost:"https://api.mixpanel.com",token:"707d695b23f66e2adbb7b980bc6e4ef2"},getUserId:function(a){chrome.storage.local.get("codotaUserId",function(b){_.isUndefined(b.codotaUserId)?(codotaUserId=MixpanelManager.UUID(),MixpanelManager.setUserId(codotaUserId,function(){a(codotaUserId)})):a(b.codotaUserId)})},setUserId:function(a,b){chrome.storage.local.set({codotaUserId:a},b)},alias:function(a){var b=this;this.getUserId(function(c){c!=a&&(b.track("$create_alias",{alias:a,distinct_id:c}),b.setUserId(a,function(){console.log("Aliased user id %s to: %s",a,c)}))})},track:function(a,b,c){var d=this;c=c||function(){},b=b||{},b.token=b.token||this.config.token,this.getUserId(function(c){b=_.extend({},d.info.properties(),{distinct_id:c},b);var e={event:a,properties:b},f=d.truncate(e,255),g=d.JSONEncode(f),h=d.base64Encode(g);d._sendRequest(d.config.apiHost+"/track/",{data:h})})},trackPageView:function(a){a=a||document.location.href,this.track("Extension Page View",this.info.pageviewInfo(a))},_sendRequest:function(a,b){b=_.extend(b,{ip:1,_:(new Date).getTime().toString()}),a+="?"+MixpanelManager.HTTPBuildQuery(b);var c=new XMLHttpRequest;c.open("GET",a,!0),c.withCredentials=!0,c.onreadystatechange=function(a){if(4===c.readyState)if(200===c.status);else{var b="Bad HTTP status: "+c.status+" "+c.statusText;console.error(b)}},c.send(null)},HTTPBuildQuery:function(a,b){var c,d,e=[];return void 0===b&&(b="&"),_.each(a,function(a,b){c=encodeURIComponent(a.toString()),d=encodeURIComponent(b),e[e.length]=d+"="+c}),e.join(b)},truncate:function(a,b){var c;return"string"==typeof a?c=a.slice(0,b):_.isArray(a)?(c=[],_.each(a,function(a){c.push(MixpanelManager.truncate(a,b))})):_.isObject(a)?(c={},_.each(a,function(a,d){c[d]=MixpanelManager.truncate(a,b)})):c=a,c},utf8Encode:function(a){a=(a+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b,c,d,e="",f=0;for(b=c=0,f=a.length,d=0;d<f;d++){var g=a.charCodeAt(d),h=null;g<128?c++:h=g>127&&g<2048?String.fromCharCode(g>>6|192,63&g|128):String.fromCharCode(g>>12|224,g>>6&63|128,63&g|128),null!==h&&(c>b&&(e+=a.substring(b,c)),e+=h,b=c=d+1)}return c>b&&(e+=a.substring(b,a.length)),e},JSONEncode:function(){return function(a){var b=a,c=function(a){var b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return b.lastIndex=0,b.test(a)?'"'+a.replace(b,function(a){var b=c[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},d=function(a,b){var e="",f=0,g="",h="",i=0,j=e,k=[],l=b[a];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(a)),typeof l){case"string":return c(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(e+="    ",k=[],"[object Array]"===toString.apply(l)){for(i=l.length,f=0;f<i;f+=1)k[f]=d(f,l)||"null";return h=0===k.length?"[]":e?"[\n"+e+k.join(",\n"+e)+"\n"+j+"]":"["+k.join(",")+"]",e=j,h}for(g in l)hasOwnProperty.call(l,g)&&(h=d(g,l))&&k.push(c(g)+(e?": ":":")+h);return h=0===k.length?"{}":e?"{"+k.join(",")+j+"}":"{"+k.join(",")+"}",e=j,h}};return d("",{"":b})}}(),base64Encode:function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;a=MixpanelManager.utf8Encode(a);do{b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h)}while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m},UUID:function(){var a=function(){for(var a=1*new Date,b=0;a==1*new Date;)b++;return a.toString(16)+b.toString(16)},b=function(){return Math.random().toString(16).replace(".","")},c=function(a){function b(a,b){var c,d=0;for(c=0;c<b.length;c++)d|=f[c]<<8*c;return a^d}var c,d,e=userAgent,f=[],g=0;for(c=0;c<e.length;c++)d=e.charCodeAt(c),f.unshift(255&d),f.length>=4&&(g=b(g,f),f=[]);return f.length>0&&(g=b(g,f)),g.toString(16)};return function(){var d=(screen.height*screen.width).toString(16);return a()+"-"+b()+"-"+c()+"-"+d+"-"+a()}}(),info:{campaignParams:function(){var a="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),b="",c={};return _.each(a,function(a){b=_.getQueryParam(document.URL,a),b.length&&(c[a]=b)}),c},searchEngine:function(a){return 0===a.search("https?://(.*)google.([^/?]*)")?"google":0===a.search("https?://(.*)bing.com")?"bing":0===a.search("https?://(.*)yahoo.com")?"yahoo":0===a.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(a){var b=_.info.searchEngine(a),c="yahoo"!=b?"q":"p",d={};if(null!==b){d.$search_engine=b;var e=_.getQueryParam(a,c);e.length&&(d.mp_keyword=e)}return d},browser:function(a,b,c){var b=b||"";return c?StringUtil.includes(a,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":StringUtil.includes(a,"FBIOS")?"Facebook Mobile":StringUtil.includes(a,"Chrome")?"Chrome":StringUtil.includes(a,"CriOS")?"Chrome iOS":StringUtil.includes(b,"Apple")?StringUtil.includes(a,"Mobile")?"Mobile Safari":"Safari":StringUtil.includes(a,"Android")?"Android Mobile":StringUtil.includes(a,"Konqueror")?"Konqueror":StringUtil.includes(a,"Firefox")?"Firefox":StringUtil.includes(a,"MSIE")||StringUtil.includes(a,"Trident/")?"Internet Explorer":StringUtil.includes(a,"Gecko")?"Mozilla":""},os:function(){var a=userAgent;return/Windows/i.test(a)?/Phone/.test(a)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(a)?"iOS":/Android/.test(a)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Mac/i.test(a)?"Mac OS X":/Linux/.test(a)?"Linux":""},device:function(a){return/iPad/.test(a)?"iPad":/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Windows Phone/i.test(a)?"Windows Phone":/Android/.test(a)?"Android":""},referringDomain:function(a){var b=a.split("/");return b.length>=3?b[2]:""},properties:function(){return _.extend(this.stripEmptyProperties({$os:MixpanelManager.info.os(),$browser:MixpanelManager.info.browser(userAgent,navigator.vendor,window.opera),$referrer:document.referrer,$referring_domain:MixpanelManager.info.referringDomain(document.referrer),$device:MixpanelManager.info.device(userAgent),site:document.location.origin}),{$screen_height:screen.height,$screen_width:screen.width})},pageviewInfo:function(a){return this.stripEmptyProperties({mp_page:a,mp_referrer:document.referrer,mp_browser:MixpanelManager.info.browser(userAgent,navigator.vendor,window.opera),mp_platform:MixpanelManager.info.os()})},stripEmptyProperties:function(a){var b={};return _.each(a,function(a,c){_.isString(a)&&a.length>0&&(b[c]=a)}),b}}},StringUtil={includes:function(a,b){return-1!==a.indexOf(b)}};