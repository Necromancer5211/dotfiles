function hideOtherPopovers(a){$(".source-hl").not(a).popover("hide").removeClass("api-hl-selected"),$(".watermark").not(a).popover("hide")}function formatLivecode(a,b){var c=$("body");c.unbind("click").unbind("scroll"),c.scroll(hideOtherPopovers).click(hideOtherPopovers),$snippet=$(a),$snippet.find(".var-hl,.source-hl").unbind("click"),$snippet.find(".var-hl").click(function(a){var b='[data-varId="'+$(this).attr("data-varId")+'"]';$(this).parents("pre:first").find(".var-hl"+b).toggleClass("var-hl-selected"),$(this).parents("pre:first").find(".var-hl-selected").not(b).removeClass("var-hl-selected"),_gaq.push(["_trackEvent","var","clicked",$(this).text()]),MixpanelManager.track("Extension - Var Clicked",{var:$(this).text()})}),trackEvents($snippet),$snippet.find(".source-hl").click(function(a){a.stopPropagation(),hideOtherPopovers(this);var b=$(this).attr("data-classId"),c=$(this).attr("data-methodIndex"),d=$(this).attr("data-attr"),e=$(this).attr("data-val");const f=$(this).attr("data-title").split(".").slice(0,-1).join("."),g=$(this).attr("data-title").split(".").slice(-1)[0];var h,i=this;b?(h=codotaHost+"/api/apidocs/"+b,c&&(h+="/"+c)):d&&(h=codotaHost+"/api/xmldocs/"+d,e&&(h+="/"+e)),h?$.getJSON(h,function(a){const b=docTemplate.replace("{{DOC_CONTENT}}",a.text).replace("{{DOC_SYMBOL}}",g).replace("{{DOC_NAMESPACE}}",f).replace("{{DOC_SUGGESTION_LINK}}",CODOTA_APP+"/code"+$(i).attr("data-searchTerm")).replace("{{DOC_LINK}}",$(i).attr("data-docLink")).replace("{{ASSETS_BASE_URL}}",chrome.extension.getURL("/"));$(i).popover("destroy"),$(i).removeAttr("data-classId"),$(i).removeAttr("data-attr"),$(i).popover({trigger:"manual",content:b,title:null,container:".codota-scope"}),$(i).popover("toggle").toggleClass("api-hl-selected"),$(".popover").find("a").click(function(a){a.stopPropagation()})}):($(this).popover("toggle").toggleClass("api-hl-selected"),$(".popover").find("a").click(function(a){a.stopPropagation()}))}),$snippet.find(".source-hl").popover({trigger:"manual",container:".codota-scope"}),$snippet.find('[rel="tooltip"]').tooltip({trigger:"hover",container:".codota-scope"}),$snippet.find(".api-hl").tooltip("destroy"),0==$("form#codebox-form").length&&($codeboxForm=$('<form id="codebox-form" method="post" style="display: none;"></form>'),c.append($codeboxForm))}function trackEvents(a){a.find(".api-hl").unbind("shown.bs.tooltip").on("shown.bs.tooltip",function(a){_gaq.push(["_trackEvent","api","tooltip",$(this).attr("data-title")])}),a.find(".var-hl").unbind("shown.bs.tooltip").on("shown.bs.tooltip",function(a){_gaq.push(["_trackEvent","var","tooltip",$(this).text()])}),a.find(".type-hl").unbind("shown.bs.tooltip").on("shown.bs.tooltip",function(a){_gaq.push(["_trackEvent","class","tooltip",$(this).attr("data-title")])}),a.find(".api-hl").unbind("click").click(function(a){var b=$(this).attr("data-title");_gaq.push(["_trackEvent","api","clicked",b]),MixpanelManager.track("Extension - API Clicked",{API:b})}),a.find(".type-hl").unbind("click").click(function(a){var b=$(this).attr("data-title");_gaq.push(["_trackEvent","class","clicked",b]),MixpanelManager.track("Extension - Class Clicked",{Class:b})}),a.find(".attr-hl").unbind("click").click(function(a){var b=$(this).attr("data-title");_gaq.push(["_trackEvent","attr","clicked",b]),MixpanelManager.track("Extension - Attribute Clicked",{Attribute:b})}),a.find(".attrval-hl").unbind("click").click(function(a){var b=$(this).attr("data-title");_gaq.push(["_trackEvent","attrval","clicked",b]),MixpanelManager.track("Extension - Attribute Value Clicked",{"Attribute Value":b})})}function addCodotaTopBar(a){$.get(chrome.extension.getURL("menu.html"),function(b){$(".top-box").each(function(c,d){var e=$(d).next(),f=e.attr("data-snippet-id");if(!e.attr("data-codota-status")&&f){e.attr("data-codota-status","in-progress");const g=$(".codota-scope");var h=$(e).find(".source-hl,.var-hl"),i="Info available for "+String(h.length)+" elements in snippet. Click for details...",j=$('<div data-snippet-id="'+f+'" class="top-bar-placeholder"></div>'),k=$('<a class="watermark" rel="tooltip" data-container=".codota-scope" data-delay="500" data-title="'+i+'"></a>');const l=$('<a class="codota-saves-selection-button"><i class="icon codota-icon-legal"></i> <span>Save Selection</span></a>');if(j.append(l),j.append(k),g.append(j),l.hide(),!positionTopBar(e,j,a))return $(".top-bar-placeholder").remove(),topBarDensity.aborted=!0,!1;$(window).resize(function(){positionTopBar(e,j,a)}),[1,3].forEach(function(b){setTimeout(function(){positionTopBar(e,j,a)},1e3*b)}),j.hide();var m=void 0;$(e).add(j).hover(function(){m&&(clearTimeout(m),m=void 0),j.show()},function(){if($(".popover:hover").length)return!1;m=setTimeout(function(){j.hide()},300)}),codotaMenu(e,k,b,a),e.attr("data-codota-status","done")}}),topBarDensity.shouldCheck=!1,removeOrphanTopBars()})}function hideSaveSelectionButtons(a,b){const c=getTopBarBySnippetId(a.attr("data-snippet-id"));c.children(".codota-saves-selection-button").hide(),positionTopBar(a,c,b)}function setOnSnippetSelected(a,b,c){var d=getTopBarBySnippetId(a.attr("data-snippet-id")),e=d.children(".codota-saves-selection-button");e.show(),setSaveSnippetBtn(e,a,b,c),positionTopBar(a,d,c)}function removeOrphanTopBars(){$(".top-bar-placeholder").each(function(a,b){$topBar=$(b);var c=$topBar.attr("data-snippet-id");"undefined"!=c&&0!=$("[data-snippet-id='"+c+"']").filter(":not(.top-bar-placeholder)").length||($topBar.remove(),$topBar.destroyed=!0)})}function showSaveReminder(a){var b=getTopBarBySnippetId(a.attr("data-snippet-id"));if(b.length>0){var c=b.children(".codebox-save-selection-btn:visible");0==c.length&&(c=b.children(".codebox-save-btn")),c.attr({"data-html":!0,"data-content":'Like this snippet? Save it to your <a class="save-snippet-popover" href="'+codotaHost+'/codebox/" target="_blank">CodeBox</a>!',"data-container":".green-popovers-container","data-title":"","data-placement":"top"}),c.popover("show"),setTimeout(function(){c.popover("hide")},4e3)}}function getTopBarBySnippetId(a){return $("[data-snippet-id='"+a+"']").filter(".top-bar-placeholder")}function hideBtn(a){a.hide(),a.popover("hide")}function setSaveSnippetBtn(a,b,c,d){const e=getSnippetId(b),f=c||getSnippetContent(b);if("true"===b.attr("data-snippet-saved")){const g=b.attr("data-user-snippet-id");setButtonLabel(a,"Saved"),a.addClass(BOOKMARK_SAVED_BUTTON_CLASS),a.unbind("click").click(function(){window.open(codotaHost+"/codebox/#/"+g+"/edit","_blank").focus(),_gaq.push(["_trackEvent","codebox","in-codebox-badge-click"]),MixpanelManager.track("Extension - Badge Clicked")})}else a.unbind("click").click(function(){const g=c?"codebox-save-selection-btn":"codebox-save-btn",h=c?"Save Selection Clicked":"Save Clicked";_gaq.push(["_trackEvent","codebox",g,"click"]),MixpanelManager.track("Extension - "+h),a.addClass(BOOKMARK_SAVED_BUTTON_CLASS),setButtonLabel(a,"saving..");const i=a.parent();positionTopBar(b,i,d),$.getJSON(codotaHost+"/api/postToken").done(function(h){CodeBoxManager.saveSnippet(e,f,window.document.title,window.location.href,d.getSnippetTags(b),h.csrfToken,function(){},function(e,f){e?console.log(e):(setButtonLabel(a,"Saved"),b.attr("data-user-snippet-id",f.id),b.attr("data-snippet-saved","true"),positionTopBar(b,i,d),c&&setTimeout(function(){a.hide(),positionTopBar(b,i,d)},1e3),_gaq.push(["_trackEvent","codebox","snippet-saved",g]),MixpanelManager.track("Extension - Snippet Saved",{Button:g}),$.fancybox.close(),setSaveSnippetBtn(a,b,c,d))})})})}function positionTopBar(a,b,c){if(topBarDensity.aborted||b.destroyed)return!1;$topBarPositioningElement=a,"function"==typeof c.topBarPositioningElement&&($topBarPositioningElement=c.topBarPositioningElement(a));var d=$topBarPositioningElement.offset(),e=0;if($topBarPositioningElement&&(e=$topBarPositioningElement.topBarTopOffset||0),!0===topBarDensity.shouldCheck){var f=d&&d.top,g=Math.floor(f/100);if(void 0==topBarDensity[g]&&(topBarDensity[g]=[]),topBarDensity[g].push(d.top),topBarDensity[g].length>2)return console.log("Stopping the execution because density of top bars is high: ",topBarDensity),!1}return b.css({top:d&&d.top+13+e,left:Math.min($(window).width()-300,d&&d.left+$topBarPositioningElement.outerWidth()-(b.width()+25))}),!0}function codotaMenu(a,b,c,d){const e=getSnippetId(a),f=getSnippetContent(a),g=getMenuId(e),h="true"===a.attr("data-snippet-saved");b.popover({html:!0,title:"",content:c.replace("{{LIVECODE_ID}}",g).replace("{{SAVE_BUTTON_LABEL}}",h?"Saved":"Save").replace("{{SAVE_BUTTON_CLASS}}",h?BOOKMARK_SAVED_BUTTON_CLASS:""),trigger:"hover",delay:0,placement:"bottom",container:".codota-scope"}),b.on("hide.bs.popover",function(){if($(".popover:hover").length)return!1}),$("body").on("mouseleave",".popover",function(){b.popover("hide")}),b.on("shown.bs.popover",function(){setSaveSnippetBtn($("#"+g+" ."+BOOKMARK_BUTTON_CLASS),a,!1,d)}),$(document).on("click","#"+g+" .livecode-menu-copy",function(a){copySnippetToClipboard(f),flashTooltip($(a.currentTarget),"Copied!")}),$(document).on("click","#"+g+" .livecode-menu-share",function(b){shareSnippet(a)}),b.unbind("hover").hover(function(){if(0==$(".livecode-menu:visible").parents(".popover").hasClass("popover")){_gaq.push(["_trackEvent","menu","show_live_parts"]);applyWelcomeHl(a.find(".source-hl,.var-hl"))}},function(){return null}),$(b).unbind("click").click(function(a){a.stopPropagation();var b=$(".livecode-menu:visible").parents(".popover");b.hasClass("popover")&&($.getScript("https://apis.google.com/js/plusone.js"),_gaq.push(["_trackEvent","menu","expanded"]),MixpanelManager.track("Extension - Watermark Clicked"),b.css("z-index",30),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//widget.uservoice.com/iDbMOMcL087BI7NhSsFaA.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),UserVoice=window.UserVoice||[])})}function applyWelcomeHl(a){$(".codota-welcome-hl").removeClass("codota-welcome-hl"),setTimeout(function(){a.addClass("codota-welcome-hl")},20)}function scrollToElement(a,b,c){var d=$(b).position().top-a.position().top,e=d-50;a.animate({scrollTop:a.scrollTop()+e},100,c)}topBarDensity={shouldCheck:!0};const BOOKMARK_BUTTON_CLASS="livecode-menu-bookmark",BOOKMARK_SAVED_BUTTON_CLASS="active";var docTemplate;$.get(chrome.extension.getURL("doc.html"),function(a){docTemplate=a});const shareSnippet=function(a){CodeBoxManager.shareSnippet(a),_gaq.push(["_trackEvent","codebox","share-btn","click"]),MixpanelManager.track("Share Snippet",{sharedBy:"Extension - Share Button"})},copySnippetToClipboard=function(a){copyToClipboard(a),_gaq.push(["_trackEvent","codebox","copy-snippet-click"]),MixpanelManager.track("Extension - Copy Clicked")},copyToClipboard=function(a){chrome.runtime.sendMessage({type:"copyToClipboard",text:a})},flashTooltip=function(a,b){a.tooltip({trigger:"manual",title:b,placement:"top"}).tooltip("show"),setTimeout(function(){a.tooltip("hide")},1e3)},setButtonLabel=function(a,b){a.children("span").text(b)};chrome.extension.onMessage.addListener(function(a){"no-cookies"==a.type&&_gaq.push(["_trackEvent","codebox","no-cookies"]),"close-fancybox"==a.type&&$.fancybox.close()});const getMenuId=function(a){return"LIVECODE_"+a.replace(".","")},getSnippetContent=function(a){return a.attr("data-original-code")},getSnippetId=function(a){return a.attr("data-snippet-id")};var q=[];